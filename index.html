<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daven's World - Ultimate Gaming Platform</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üåü</text></svg>">
    
    <!-- Crypto Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d1b69 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(15px);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: logoGlow 3s ease-in-out infinite alternate;
        }

        @keyframes logoGlow {
            from { filter: drop-shadow(0 0 20px rgba(255, 107, 107, 0.5)); }
            to { filter: drop-shadow(0 0 40px rgba(78, 205, 196, 0.8)); }
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: #fff;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            padding: 0.5rem 1rem;
            border-radius: 10px;
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 25px;
        }

        .points-badge {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .admin-badge {
            background: linear-gradient(45deg, #ff4757, #c44569);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 6rem 2rem 2rem;
        }

        /* Auth System */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .auth-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 3rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .auth-form h2 {
            text-align: center;
            margin-bottom: 2rem;
            background: linear-gradient(45deg, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-item {
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-item:hover, .sidebar-item.active {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .main-content {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Games Section */
        .games-section {
            display: none;
        }

        .games-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .game-card:hover::before {
            left: 100%;
        }

        .game-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        .game-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: block;
            text-align: center;
        }

        .game-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .game-players {
            text-align: center;
            opacity: 0.8;
            margin-top: 1rem;
        }

        /* Multiplayer Game Room */
        .game-room {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .game-room.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .game-canvas {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            margin: 2rem auto;
            display: block;
        }

        .players-list {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 15px;
            text-align: center;
            min-width: 120px;
        }

        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 0.5rem;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(45deg, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .admin-controls {
            background: rgba(255, 255, 255, 0.05);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .user-management {
            margin-top: 2rem;
        }

        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .user-table th, .user-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
        }

        .action-btn {
            padding: 0.5rem 1rem;
            margin: 0 0.25rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .ban-btn {
            background: linear-gradient(45deg, #ff4757, #c44569);
            color: white;
        }

        .unban-btn {
            background: linear-gradient(45deg, #2ed573, #7bed9f);
            color: white;
        }

        /* Private Servers */
        .private-servers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .server-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            position: relative;
        }

        .private-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .server-members {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .member-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                display: none;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="logo">üåü Daven's World</div>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#games">Games</a></li>
                <li><a href="#servers">Private Servers</a></li>
                <li><a href="#leaderboard">Leaderboard</a></li>
                <li><a href="#profile">Profile</a></li>
                <li><a href="#admin" id="adminLink" style="display:none;">Admin</a></li>
            </ul>
            <div class="user-info" id="userInfo" style="display:none;">
                <span class="points-badge" id="userPoints">0 Points</span>
                <span id="userName"></span>
                <button class="btn" onclick="logout()" style="padding: 0.5rem 1rem; margin-left: 1rem;">Logout</button>
            </div>
        </nav>
    </header>

    <div class="container">
        <!-- Auth Modal -->
        <div id="authModal" class="auth-modal">
            <div class="auth-container">
                <div class="auth-form" id="loginForm">
                    <h2>üåü Welcome to Daven's World</h2>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="loginUsername" placeholder="Enter your username">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password">
                    </div>
                    <button class="btn" onclick="login()">Login</button>
                    <p style="text-align: center; margin-top: 1rem;">
                        Don't have an account? <a href="#" onclick="showRegister()" style="color: #4ecdc4;">Register</a>
                    </p>
                </div>
                
                <div class="auth-form" id="registerForm" style="display:none;">
                    <h2>üöÄ Join Daven's World</h2>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="regUsername" placeholder="Choose a username">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="regEmail" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="regPassword" placeholder="Create a password">
                    </div>
                    <div class="form-group">
                        <label>Account Type</label>
                        <select id="regAccountType">
                            <option value="player">Player</option>
                            <option value="developer">Developer</option>
                        </select>
                    </div>
                    <button class="btn" onclick="register()">Register</button>
                    <p style="text-align: center; margin-top: 1rem;">
                        Already have an account? <a href="#" onclick="showLogin()" style="color: #4ecdc4;">Login</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard" class="dashboard" style="display:none;">
            <div class="sidebar">
                <div class="sidebar-item active" onclick="showSection('games')">
                    <span>üéÆ</span> Games
                </div>
                <div class="sidebar-item" onclick="showSection('servers')">
                    <span>üè∞</span> Private Servers
                </div>
                <div class="sidebar-item" onclick="showSection('friends')">
                    <span>üë•</span> Friends
                </div>
                <div class="sidebar-item" onclick="showSection('inventory')">
                    <span>üéí</span> Inventory
                </div>
                <div class="sidebar-item" onclick="showSection('settings')">
                    <span>‚öôÔ∏è</span> Settings
                </div>
            </div>

            <div class="main-content">
                <!-- Games Section -->
                <div id="games" class="games-section active">
                    <h2>üéÆ Multiplayer Games</h2>
                    <div class="games-grid">
                        <div class="game-card" onclick="joinGame('battle-arena')">
                            <span class="game-icon">‚öîÔ∏è</span>
                            <h3 class="game-title">Battle Arena</h3>
                            <p>Real-time PvP combat</p>
                            <div class="game-players">üë• <span id="battlePlayers">0</span> players online</div>
                        </div>
                        
                        <div class="game-card" onclick="joinGame('racing')">
                            <span class="game-icon">üèéÔ∏è</span>
                            <h3 class="game-title">Racing Masters</h3>
                            <p>Multiplayer racing</p>
                            <div class="game-players">üë• <span id="racingPlayers">0</span> players online</div>
                        </div>
                        
                        <div class="game-card" onclick="joinGame('tower-defense')">
                            <span class="game-icon">üè∞</span>
                            <h3 class="game-title">Tower Defense</h3>
                            <p>Co-op strategy game</p>
                            <div class="game-players">üë• <span id="towerPlayers">0</span> players online</div>
                        </div>
                        
                        <div class="game-card" onclick="joinGame('space-shooter')">
                            <span class="game-icon">üöÄ</span>
                            <h3 class="game-title">Space Shooter</h3>
                            <p>Team space battles</p>
                            <div class="game-players">üë• <span id="spacePlayers">0</span> players online</div>
                        </div>
                    </div>
                </div>

                <!-- Private Servers Section -->
                <div id="servers" class="games-section">
                    <h2>üè∞ Private Servers</h2>
                    <button class="btn" onclick="createPrivateServer()" style="margin-bottom: 2rem;">Create Private Server</button>
                    <div class="private-servers" id="privateServers">
                        <!-- Private servers will be loaded here -->
                    </div>
                </div>

                <!-- Admin Panel -->
                <div id="admin" class="admin-panel">
                    <h2>üîß Admin Panel</h2>
                    
                    <div class="admin-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalUsers">0</div>
                            <div>Total Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="onlineUsers">0</div>
                            <div>Online Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalGames">0</div>
                            <div>Games Played</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="bannedUsers">0</div>
                            <div>Banned Users</div>
                        </div>
                    </div>

                    <div class="admin-controls">
                        <h3>Quick Actions</h3>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button class="btn btn-success" onclick="broadcastMessage()">Broadcast Message</button>
                            <button class="btn btn-danger" onclick="clearDatabase()">Clear Database</button>
                            <button class="btn" onclick="exportData()">Export Data</button>
                        </div>
                    </div>

                    <div class="user-management">
                        <h3>User Management</h3>
                        <table class="user-table" id="userTable">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Points</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Game Room -->
                <div id="gameRoom" class="game-room">
                    <button class="game-back" onclick="leaveGame()">‚Üê Leave Game</button>
                    <h2 id="currentGameTitle"></h2>
                    
                    <div class="players-list" id="playersList">
                        <!-- Players will be shown here -->
                    </div>
                    
                    <canvas id="gameCanvas" class="game-canvas" width="800" height="600"></canvas>
                    
                    <div class="game-controls">
                        <button class="btn" onclick="readyUp()">Ready</button>
                        <button class="btn" onclick="inviteFriend()">Invite Friend</button>
                        <button class="btn" onclick="startGame()">Start Game</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Advanced Encryption System
        class SecurityManager {
            constructor() {
                this.secretKey = 'DavenWorld_Secret_Key_2024_Complex_Encryption_Key';
                this.algorithm = 'AES-256-GCM';
            }

            // Multi-layer encryption
            encrypt(data) {
                try {
                    // Layer 1: AES encryption
                    const encrypted1 = CryptoJS.AES.encrypt(JSON.stringify(data), this.secretKey).toString();
                    
                    // Layer 2: Base64 encoding
                    const encoded = btoa(encrypted1);
                    
                    // Layer 3: Reverse string
                    const reversed = encoded.split('').reverse().join('');
                    
                    // Layer 4: Caesar cipher
                    const caesar = this.caesarCipher(reversed, 13);
                    
                    return caesar;
                } catch (error) {
                    console.error('Encryption error:', error);
                    return null;
                }
            }

            decrypt(encryptedData) {
                try {
                    // Reverse Caesar cipher
                    const caesar = this.caesarCipher(encryptedData, -13);
                    
                    // Reverse string
                    const reversed = caesar.split('').reverse().join('');
                    
                    // Base64 decode
                    const decoded = atob(reversed);
                    
                    // AES decrypt
                    const decrypted = CryptoJS.AES.decrypt(decoded, this.secretKey);
                    const data = JSON.parse(decrypted.toString(CryptoJS.enc.Utf8));
                    
                    return data;
                } catch (error) {
                    console.error('Decryption error:', error);
                    return null;
                }
            }

            caesarCipher(str, shift) {
                return str.replace(/[a-zA-Z]/g, (char) => {
                    const start = char <= 'Z' ? 65 : 97;
                    return String.fromCharCode(((char.charCodeAt(0) - start + shift + 26) % 26) + start);
                });
            }

            // Bcrypt password hashing
            async hashPassword(password) {
                const salt = bcrypt.genSaltSync(12);
                return bcrypt.hashSync(password, salt);
            }

            async verifyPassword(password, hash) {
                return bcrypt.compareSync(password, hash);
            }

            // Generate secure token
            generateToken() {
                return CryptoJS.lib.WordArray.random(32).toString();
            }
        }

        // Database Manager
        class DatabaseManager {
            constructor(securityManager) {
                this.security = securityManager;
                this.dbKey = 'daven_world_encrypted_database';
                this.users = this.loadData('users') || [];
                this.games = this.loadData('games') || [];
                this.servers = this.loadData('servers') || [];
                this.sessions = this.loadData('sessions') || [];
            }

            loadData(key) {
                const encrypted = localStorage.getItem(`${this.dbKey}_${key}`);
                if (encrypted) {
                    return this.security.decrypt(encrypted);
                }
                return null;
            }

            saveData(key, data) {
                const encrypted = this.security.encrypt(data);
                localStorage.setItem(`${this.dbKey}_${key}`, encrypted);
            }

            // User Management
            createUser(userData) {
                const user = {
                    id: this.generateId(),
                    username: userData.username,
                    email: userData.email,
                    password: userData.password, // Already hashed
                    accountType: userData.accountType || 'player',
                    points: 100,
                    level: 1,
                    experience: 0,
                    status: 'active',
                    banned: false,
                    admin: false,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    friends: [],
                    inventory: [],
                    stats: {
                        gamesPlayed: 0,
                        gamesWon: 0,
                        totalScore: 0,
                        achievements: []
                    }
                };
                
                this.users.push(user);
                this.saveData('users', this.users);
                return user;
            }

            getUser(username) {
                return this.users.find(u => u.username === username);
            }

            getUserById(id) {
                return this.users.find(u => u.id === id);
            }

            updateUser(id, updates) {
                const index = this.users.findIndex(u => u.id === id);
                if (index !== -1) {
                    this.users[index] = { ...this.users[index], ...updates };
                    this.saveData('users', this.users);
                    return this.users[index];
                }
                return null;
            }

            banUser(id) {
                return this.updateUser(id, { banned: true, status: 'banned' });
            }

            unbanUser(id) {
                return this.updateUser(id, { banned: false, status: 'active' });
            }

            // Game Management
            createGameSession(gameType, hostId, maxPlayers = 4) {
                const game = {
                    id: this.generateId(),
                    type: gameType,
                    host: hostId,
                    players: [hostId],
                    maxPlayers: maxPlayers,
                    status: 'waiting',
                    createdAt: new Date().toISOString(),
                    private: false,
                    password: null
                };
                
                this.games.push(game);
                this.saveData('games', this.games);
                return game;
            }

            joinGame(gameId, userId) {
                const game = this.games.find(g => g.id === gameId);
                if (game && game.players.length < game.maxPlayers && !game.players.includes(userId)) {
                    game.players.push(userId);
                    this.saveData('games', this.games);
                    return game;
                }
                return null;
            }

            leaveGame(gameId, userId) {
                const game = this.games.find(g => g.id === gameId);
                if (game) {
                    game.players = game.players.filter(p => p !== userId);
                    if (game.players.length === 0) {
                        this.games = this.games.filter(g => g.id !== gameId);
                    }
                    this.saveData('games', this.games);
                    return game;
                }
                return null;
            }

            // Private Server Management
            createPrivateServer(ownerId, name, maxMembers = 10) {
                const server = {
                    id: this.generateId(),
                    name: name,
                    owner: ownerId,
                    members: [ownerId],
                    maxMembers: maxMembers,
                    createdAt: new Date().toISOString(),
                    inviteCode: this.generateInviteCode(),
                    gamesPlayed: 0,
                    totalPoints: 0
                };
                
                this.servers.push(server);
                this.saveData('servers', this.servers);
                return server;
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            generateInviteCode() {
                return Math.random().toString(36).substr(2, 8).toUpperCase();
            }

            // Session Management
            createSession(userId) {
                const session = {
                    id: this.security.generateToken(),
                    userId: userId,
                    createdAt: new Date().toISOString(),
                    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString() // 24 hours
                };
                
                this.sessions.push(session);
                this.saveData('sessions', this.sessions);
                return session;
            }

            validateSession(sessionId) {
                const session = this.sessions.find(s => s.id === sessionId);
                if (session && new Date(session.expiresAt) > new Date()) {
                    return session;
                }
                return null;
            }

            deleteSession(sessionId) {
                this.sessions = this.sessions.filter(s => s.id !== sessionId);
                this.saveData('sessions', this.sessions);
            }

            // Get all data for admin
            getAllData() {
                return {
                    users: this.users,
                    games: this.games,
                    servers: this.servers,
                    sessions: this.sessions
                };
            }
        }

        // Game Engine
        class GameEngine {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.currentGame = null;
                this.players = [];
                this.gameLoop = null;
            }

            initGame(gameType, players) {
                this.currentGame = gameType;
                this.players = players;
                this.setupGame();
            }

            setupGame() {
                switch(this.currentGame) {
                    case 'battle-arena':
                        this.setupBattleArena();
                        break;
                    case 'racing':
                        this.setupRacing();
                        break;
                    case 'tower-defense':
                        this.setupTowerDefense();
                        break;
                    case 'space-shooter':
                        this.setupSpaceShooter();
                        break;
                }
            }

            setupBattleArena() {
                // Battle Arena game setup
                this.gameState = {
                    players: this.players.map((p, i) => ({
                        id: p.id,
                        x: 100 + (i * 200),
                        y: 300,
                        health: 100,
                        color: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24'][i % 4]
                    })),
                    projectiles: [],
                    powerups: []
                };
                
                this.startGameLoop();
            }

            setupRacing() {
                // Racing game setup
                this.gameState = {
                    players: this.players.map((p, i) => ({
                        id: p.id,
                        x: 50 + (i * 30),
                        y: 400 + (i * 40),
                        speed: 0,
                        position: 0,
                        color: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24'][i % 4]
                    })),
                    track: this.generateTrack()
                };
                
                this.startGameLoop();
            }

            setupTowerDefense() {
                // Tower Defense setup
                this.gameState = {
                    players: this.players.map((p, i) => ({
                        id: p.id,
                        towers: [],
                        health: 100,
                        gold: 500,
                        wave: 1
                    })),
                    enemies: [],
                    projectiles: []
                };
                
                this.startGameLoop();
            }

            setupSpaceShooter() {
                // Space Shooter setup
                this.gameState = {
                    players: this.players.map((p, i) => ({
                        id: p.id,
                        x: 200 + (i * 200),
                        y: 500,
                        health: 100,
                        score: 0,
                        color: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24'][i % 4]
                    })),
                    enemies: [],
                    bullets: [],
                    powerups: []
                };
                
                this.startGameLoop();
            }

            generateTrack() {
                const track = [];
                for (let i = 0; i < 10; i++) {
                    track.push({
                        x: i * 80,
                        y: 200 + Math.sin(i * 0.5) * 100,
                        width: 80,
                        height: 20
                    });
                }
                return track;
            }

            startGameLoop() {
                this.gameLoop = setInterval(() => {
                    this.update();
                    this.render();
                }, 1000 / 60); // 60 FPS
            }

            update() {
                if (!this.gameState) return;

                switch(this.currentGame) {
                    case 'battle-arena':
                        this.updateBattleArena();
                        break;
                    case 'racing':
                        this.updateRacing();
                        break;
                    case 'tower-defense':
                        this.updateTowerDefense();
                        break;
                    case 'space-shooter':
                        this.updateSpaceShooter();
                        break;
                }
            }

            updateBattleArena() {
                // Update projectiles
                this.gameState.projectiles = this.gameState.projectiles.filter(proj => {
                    proj.x += proj.vx;
                    proj.y += proj.vy;
                    return proj.x > 0 && proj.x < 800 && proj.y > 0 && proj.y < 600;
                });

                // Check collisions
                this.gameState.projectiles.forEach((proj, projIndex) => {
                    this.gameState.players.forEach(player => {
                        if (player.id !== proj.playerId && 
                            Math.abs(player.x - proj.x) < 20 && 
                            Math.abs(player.y - proj.y) < 20) {
                            player.health -= 10;
                            this.gameState.projectiles.splice(projIndex, 1);
                        }
                    });
                });

                // Spawn powerups
                if (Math.random() < 0.01) {
                    this.gameState.powerups.push({
                        x: Math.random() * 750,
                        y: Math.random() * 550,
                        type: Math.random() < 0.5 ? 'health' : 'speed',
                        color: Math.random() < 0.5 ? '#2ed573' : '#ffa502'
                    });
                }
            }

            updateRacing() {
                this.gameState.players.forEach(player => {
                    if (player.speed > 0) {
                        player.x += player.speed;
                        player.position += player.speed;
                        
                        // Check finish line
                        if (player.position >= 800) {
                            this.endGame(player.id);
                        }
                    }
                });
            }

            updateTowerDefense() {
                // Spawn enemies
                if (Math.random() < 0.02) {
                    this.gameState.enemies.push({
                        x: 0,
                        y: Math.random() * 600,
                        health: 50,
                        speed: 1,
                        reward: 10
                    });
                }

                // Update enemies
                this.gameState.enemies = this.gameState.enemies.filter(enemy => {
                    enemy.x += enemy.speed;
                    return enemy.x < 800;
                });

                // Update projectiles
                this.gameState.projectiles = this.gameState.projectiles.filter(proj => {
                    proj.x += proj.vx;
                    proj.y += proj.vy;
                    return proj.x < 800;
                });
            }

            updateSpaceShooter() {
                // Spawn enemies
                if (Math.random() < 0.03) {
                    this.gameState.enemies.push({
                        x: Math.random() * 750,
                        y: -50,
                        health: 30,
                        speed: 2
                    });
                }

                // Update enemies
                this.gameState.enemies = this.gameState.enemies.filter(enemy => {
                    enemy.y += enemy.speed;
                    return enemy.y < 650;
                });

                // Update bullets
                this.gameState.bullets = this.gameState.bullets.filter(bullet => {
                    bullet.y -= bullet.speed;
                    return bullet.y > -10;
                });

                // Check bullet-enemy collisions
                this.gameState.bullets.forEach((bullet, bIndex) => {
                    this.gameState.enemies.forEach((enemy, eIndex) => {
                        if (Math.abs(bullet.x - enemy.x) < 20 && Math.abs(bullet.y - enemy.y) < 20) {
                            enemy.health -= 10;
                            this.gameState.bullets.splice(bIndex, 1);
                            
                            if (enemy.health <= 0) {
                                this.gameState.enemies.splice(eIndex, 1);
                                const player = this.gameState.players.find(p => p.id === bullet.playerId);
                                if (player) player.score += 100;
                            }
                        }
                    });
                });
            }

            render() {
                if (!this.gameState) return;

                // Clear canvas
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, 800, 600);

                switch(this.currentGame) {
                    case 'battle-arena':
                        this.renderBattleArena();
                        break;
                    case 'racing':
                        this.renderRacing();
                        break;
                    case 'tower-defense':
                        this.renderTowerDefense();
                        break;
                    case 'space-shooter':
                        this.renderSpaceShooter();
                        break;
                }
            }

            renderBattleArena() {
                // Render players
                this.gameState.players.forEach(player => {
                    this.ctx.fillStyle = player.color;
                    this.ctx.fillRect(player.x - 15, player.y - 15, 30, 30);
                    
                    // Health bar
                    this.ctx.fillStyle = '#ff4757';
                    this.ctx.fillRect(player.x - 20, player.y - 25, 40, 5);
                    this.ctx.fillStyle = '#2ed573';
                    this.ctx.fillRect(player.x - 20, player.y - 25, (player.health / 100) * 40, 5);
                });

                // Render projectiles
                this.gameState.projectiles.forEach(proj => {
                    this.ctx.fillStyle = '#ffa502';
                    this.ctx.beginPath();
                    this.ctx.arc(proj.x, proj.y, 5, 0, Math.PI * 2);
                    this.ctx.fill();
                });

                // Render powerups
                this.gameState.powerups.forEach(powerup => {
                    this.ctx.fillStyle = powerup.color;
                    this.ctx.beginPath();
                    this.ctx.arc(powerup.x, powerup.y, 10, 0, Math.PI * 2);
                    this.ctx.fill();
                });
            }

            renderRacing() {
                // Render track
                this.ctx.fillStyle = '#333';
                this.gameState.track.forEach(segment => {
                    this.ctx.fillRect(segment.x, segment.y, segment.width, segment.height);
                });

                // Render players
                this.gameState.players.forEach(player => {
                    this.ctx.fillStyle = player.color;
                    this.ctx.fillRect(player.x, player.y, 20, 15);
                });
            }

            renderTowerDefense() {
                // Render towers
                this.gameState.players.forEach(player => {
                    player.towers.forEach(tower => {
                        this.ctx.fillStyle = '#4ecdc4';
                        this.ctx.fillRect(tower.x - 10, tower.y - 10, 20, 20);
                    });
                });

                // Render enemies
                this.gameState.enemies.forEach(enemy => {
                    this.ctx.fillStyle = '#ff4757';
                    this.ctx.beginPath();
                    this.ctx.arc(enemy.x, enemy.y, 10, 0, Math.PI * 2);
                    this.ctx.fill();
                });

                // Render projectiles
                this.gameState.projectiles.forEach(proj => {
                    this.ctx.fillStyle = '#ffa502';
                    this.ctx.beginPath();
                    this.ctx.arc(proj.x, proj.y, 3, 0, Math.PI * 2);
                    this.ctx.fill();
                });
            }

            renderSpaceShooter() {
                // Render players
                this.gameState.players.forEach(player => {
                    this.ctx.fillStyle = player.color;
                    this.ctx.beginPath();
                    this.ctx.moveTo(player.x, player.y - 15);
                    this.ctx.lineTo(player.x - 10, player.y + 10);
                    this.ctx.lineTo(player.x + 10, player.y + 10);
                    this.ctx.closePath();
                    this.ctx.fill();
                });

                // Render enemies
                this.gameState.enemies.forEach(enemy => {
                    this.ctx.fillStyle = '#ff4757';
                    this.ctx.beginPath();
                    this.ctx.arc(enemy.x, enemy.y, 15, 0, Math.PI * 2);
                    this.ctx.fill();
                });

                // Render bullets
                this.gameState.bullets.forEach(bullet => {
                    this.ctx.fillStyle = '#ffa502';
                    this.ctx.beginPath();
                    this.ctx.arc(bullet.x, bullet.y, 3, 0, Math.PI * 2);
                    this.ctx.fill();
                });
            }

            handleInput(action, data) {
                if (!this.gameState) return;

                switch(this.currentGame) {
                    case 'battle-arena':
                        if (action === 'shoot') {
                            const player = this.gameState.players.find(p => p.id === data.playerId);
                            if (player) {
                                this.gameState.projectiles.push({
                                    x: player.x,
                                    y: player.y,
                                    vx: data.vx,
                                    vy: data.vy,
                                    playerId: data.playerId
                                });
                            }
                        }
                        break;
                    case 'racing':
                        if (action === 'accelerate') {
                            const player = this.gameState.players.find(p => p.id === data.playerId);
                            if (player) {
                                player.speed = Math.min(player.speed + 0.5, 5);
                            }
                        }
                        break;
                    case 'space-shooter':
                        if (action === 'shoot') {
                            const player = this.gameState.players.find(p => p.id === data.playerId);
                            if (player) {
                                this.gameState.bullets.push({
                                    x: player.x,
                                    y: player.y,
                                    speed: 8,
                                    playerId: data.playerId
                                });
                            }
                        }
                        break;
                }
            }

            endGame(winnerId) {
                if (this.gameLoop) {
                    clearInterval(this.gameLoop);
                }
                
                // Notify winner and update points
                const winner = this.players.find(p => p.id === winnerId);
                if (winner) {
                    winner.points += 100;
                    alert(`üèÜ ${winner.username} wins! +100 points`);
                }
            }

            destroy() {
                if (this.gameLoop) {
                    clearInterval(this.gameLoop);
                }
                this.gameState = null;
                this.players = [];
            }
        }

        // Application State
        let currentUser = null;
        let currentSession = null;
        let securityManager = new SecurityManager();
        let databaseManager = new DatabaseManager(securityManager);
        let gameEngine = new GameEngine();

        // Authentication Functions
        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                alert('Please fill in all fields');
                return;
            }

            const user = databaseManager.getUser(username);
            if (!user) {
                alert('User not found');
                return;
            }

            const isValid = await securityManager.verifyPassword(password, user.password);
            if (!isValid) {
                alert('Invalid password');
                return;
            }

            if (user.banned) {
                alert('Your account has been banned. Contact support.');
                return;
            }

            // Create session
            currentSession = databaseManager.createSession(user.id);
            currentUser = user;

            // Update last login
            databaseManager.updateUser(user.id, { lastLogin: new Date().toISOString() });

            // Update UI
            updateUI();
            showDashboard();
        }

        async function register() {
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const accountType = document.getElementById('regAccountType').value;

            if (!username || !email || !password) {
                alert('Please fill in all fields');
                return;
            }

            // Check if user exists
            if (databaseManager.getUser(username)) {
                alert('Username already exists');
                return;
            }

            // Hash password
            const hashedPassword = await securityManager.hashPassword(password);

            // Create user
            const user = databaseManager.createUser({
                username,
                email,
                password: hashedPassword,
                accountType
            });

            alert('Registration successful! Please login.');
            showLogin();
        }

        function logout() {
            if (currentSession) {
                databaseManager.deleteSession(currentSession.id);
            }
            currentUser = null;
            currentSession = null;
            showAuthModal();
        }

        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            updatePlayerCounts();
            loadPrivateServers();
            
            if (currentUser && currentUser.admin) {
                document.getElementById('adminLink').style.display = 'block';
                loadAdminData();
            }
        }

        function showAuthModal() {
            document.getElementById('authModal').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
        }

        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.games-section, .admin-panel').forEach(s => {
                s.classList.remove('active');
            });
            
            // Remove active from sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            if (section === 'admin') {
                document.getElementById('admin').classList.add('active');
            } else {
                document.getElementById(section).classList.add('active');
            }
            
            // Update sidebar
            event.target.closest('.sidebar-item').classList.add('active');
        }

        function updateUI() {
            if (currentUser) {
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('userName').textContent = currentUser.username;
                document.getElementById('userPoints').textContent = `${currentUser.points} Points`;
                
                if (currentUser.admin) {
                    const adminBadge = document.createElement('span');
                    adminBadge.className = 'admin-badge';
                    adminBadge.textContent = 'ADMIN';
                    document.getElementById('userInfo').appendChild(adminBadge);
                }
            }
        }

        // Game Functions
        function joinGame(gameType) {
            const game = databaseManager.createGameSession(gameType, currentUser.id);
            currentGame = game;
            
            document.getElementById('games').classList.remove('active');
            document.getElementById('gameRoom').classList.add('active');
            document.getElementById('currentGameTitle').textContent = `üéÆ ${getGameName(gameType)}`;
            
            // Initialize game engine
            gameEngine.initGame(gameType, [currentUser]);
            
            // Update players list
            updatePlayersList();
        }

        function leaveGame() {
            if (currentGame) {
                databaseManager.leaveGame(currentGame.id, currentUser.id);
                gameEngine.destroy();
            }
            
            document.getElementById('gameRoom').classList.remove('active');
            document.getElementById('games').classList.add('active');
            currentGame = null;
        }

        function getGameName(gameType) {
            const names = {
                'battle-arena': 'Battle Arena',
                'racing': 'Racing Masters',
                'tower-defense': 'Tower Defense',
                'space-shooter': 'Space Shooter'
            };
            return names[gameType] || 'Unknown Game';
        }

        function updatePlayersList() {
            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';
            
            if (currentGame) {
                currentGame.players.forEach(playerId => {
                    const user = databaseManager.getUserById(playerId);
                    if (user) {
                        const playerCard = document.createElement('div');
                        playerCard.className = 'player-card';
                        playerCard.innerHTML = `
                            <div class="player-avatar">${user.username.charAt(0).toUpperCase()}</div>
                            <div>${user.username}</div>
                            <div style="font-size: 0.8rem; opacity: 0.7;">${user.points} pts</div>
                        `;
                        playersList.appendChild(playerCard);
                    }
                });
            }
        }

        function readyUp() {
            alert('‚úÖ You are ready! Waiting for other players...');
        }

        function inviteFriend() {
            const inviteCode = prompt('Enter invite code or friend username:');
            if (inviteCode) {
                alert(`üìß Invitation sent to ${inviteCode}!`);
            }
        }

        function startGame() {
            if (currentGame && currentGame.players.length > 0) {
                alert('üéÆ Game started! Use WASD to move, SPACE to shoot.');
                
                // Add keyboard controls
                document.addEventListener('keydown', handleGameInput);
            } else {
                alert('Need at least 1 player to start!');
            }
        }

        function handleGameInput(event) {
            if (!currentGame) return;
            
            const actions = {
                'KeyW': 'up',
                'KeyS': 'down',
                'KeyA': 'left',
                'KeyD': 'right',
                'Space': 'shoot'
            };
            
            const action = actions[event.code];
            if (action) {
                gameEngine.handleInput(action, {
                    playerId: currentUser.id,
                    direction: action
                });
            }
        }

        // Private Servers
        function createPrivateServer() {
            const name = prompt('Enter server name:');
            if (name) {
                const server = databaseManager.createPrivateServer(currentUser.id, name);
                alert(`üè∞ Private server "${name}" created!\nInvite Code: ${server.inviteCode}`);
                loadPrivateServers();
            }
        }

        function loadPrivateServers() {
            const serversContainer = document.getElementById('privateServers');
            serversContainer.innerHTML = '';
            
            const userServers = databaseManager.servers.filter(s => 
                s.members.includes(currentUser.id) || s.owner === currentUser.id
            );
            
            userServers.forEach(server => {
                const serverCard = document.createElement('div');
                serverCard.className = 'server-card';
                serverCard.innerHTML = `
                    <div class="private-badge">PRIVATE</div>
                    <h3>${server.name}</h3>
                    <p>Owner: ${databaseManager.getUserById(server.owner)?.username}</p>
                    <p>Members: ${server.members.length}/${server.maxMembers}</p>
                    <p>Games Played: ${server.gamesPlayed}</p>
                    <div class="server-members">
                        ${server.members.slice(0, 5).map(memberId => {
                            const member = databaseManager.getUserById(memberId);
                            return `<div class="member-avatar" title="${member?.username}">
                                ${member?.username.charAt(0).toUpperCase()}
                            </div>`;
                        }).join('')}
                        ${server.members.length > 5 ? `<div style="margin-left: 0.5rem;">+${server.members.length - 5}</div>` : ''}
                    </div>
                    <button class="btn" onclick="joinPrivateServer('${server.id}')" style="margin-top: 1rem;">
                        Join Server
                    </button>
                `;
                serversContainer.appendChild(serverCard);
            });
        }

        function joinPrivateServer(serverId) {
            const server = databaseManager.servers.find(s => s.id === serverId);
            if (server && server.members.length < server.maxMembers) {
                if (!server.members.includes(currentUser.id)) {
                    server.members.push(currentUser.id);
                    databaseManager.saveData('servers', databaseManager.servers);
                    alert(`‚úÖ Joined ${server.name}!`);
                    loadPrivateServers();
                } else {
                    alert('You are already a member of this server!');
                }
            } else {
                alert('Server is full!');
            }
        }

        // Admin Functions
        function loadAdminData() {
            if (!currentUser || !currentUser.admin) return;
            
            const allData = databaseManager.getAllData();
            
            // Update stats
            document.getElementById('totalUsers').textContent = allData.users.length;
            document.getElementById('onlineUsers').textContent = allData.sessions.length;
            document.getElementById('totalGames').textContent = allData.games.length;
            document.getElementById('bannedUsers').textContent = allData.users.filter(u => u.banned).length;
            
            // Load user table
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            
            allData.users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${user.points}</td>
                    <td>
                        <span class="${user.banned ? 'text-danger' : 'text-success'}">
                            ${user.banned ? 'Banned' : 'Active'}
                        </span>
                    </td>
                    <td>
                        ${user.banned ? 
                            `<button class="action-btn unban-btn" onclick="unbanUser('${user.id}')">Unban</button>` :
                            `<button class="action-btn ban-btn" onclick="banUser('${user.id}')">Ban</button>`
                        }
                        <button class="action-btn" onclick="editUser('${user.id}')" style="background: #4ecdc4; color: white;">Edit</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function banUser(userId) {
            if (confirm('Are you sure you want to ban this user?')) {
                databaseManager.banUser(userId);
                alert('User banned successfully!');
                loadAdminData();
            }
        }

        function unbanUser(userId) {
            databaseManager.unbanUser(userId);
            alert('User unbanned successfully!');
            loadAdminData();
        }

        function editUser(userId) {
            const user = databaseManager.getUserById(userId);
            if (user) {
                const newPoints = prompt(`Edit points for ${user.username}:`, user.points);
                if (newPoints !== null) {
                    databaseManager.updateUser(userId, { points: parseInt(newPoints) });
                    alert('User updated successfully!');
                    loadAdminData();
                }
            }
        }

        function broadcastMessage() {
            const message = prompt('Enter broadcast message:');
            if (message) {
                alert(`üì¢ Broadcast sent: ${message}`);
                // In a real system, this would send to all online users
            }
        }

        function clearDatabase() {
            if (confirm('‚ö†Ô∏è WARNING: This will delete all data! Are you sure?')) {
                if (prompt('Type "DELETE" to confirm:') === 'DELETE') {
                    localStorage.clear();
                    alert('Database cleared!');
                    location.reload();
                }
            }
        }

        function exportData() {
            const data = databaseManager.getAllData();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'daven_world_data.json';
            a.click();
        }

        // Utility Functions
        function updatePlayerCounts() {
            const games = ['battle-arena', 'racing', 'tower-defense', 'space-shooter'];
            games.forEach(game => {
                const count = Math.floor(Math.random() * 50) + 10; // Simulate player counts
                const element = document.getElementById(game.replace('-', '') + 'Players');
                if (element) element.textContent = count;
            });
        }

        // URL Routing
        function handleRouting() {
            const path = window.location.pathname;
            
            // Handle user profiles
            const userMatch = path.match(/^\/users\/([^\/]+)\/?$/);
            if (userMatch) {
                const userId = userMatch[1];
                showUserProfile(userId);
            }
            
            // Handle game rooms
            const gameMatch = path.match(/^\/games\/([^\/]+)\/?$/);
            if (gameMatch) {
                const gameType = gameMatch[1];
                joinGame(gameType);
            }
            
            // Handle private servers
            const serverMatch = path.match(/^\/servers\/([^\/]+)\/?$/);
            if (serverMatch) {
                const serverId = serverMatch[1];
                joinPrivateServer(serverId);
            }
        }

        function showUserProfile(userId) {
            const user = databaseManager.getUserById(userId);
            if (user) {
                alert(`üë§ Profile: ${user.username}\nüìß Email: ${user.email}\n‚≠ê Level: ${user.level}\nüí∞ Points: ${user.points}\nüéÆ Games Played: ${user.stats.gamesPlayed}\nüèÜ Games Won: ${user.stats.gamesWon}`);
            } else {
                alert('User not found!');
            }
        }

        function updateURL(path) {
            window.history.pushState({}, '', path);
        }

        // Initialize Application
        function initializeApp() {
            // Check for existing session
            const savedSession = localStorage.getItem('daven_world_session');
            if (savedSession) {
                const session = databaseManager.validateSession(savedSession);
                if (session) {
                    currentSession = session;
                    currentUser = databaseManager.getUserById(session.userId);
                    if (currentUser) {
                        showDashboard();
                        return;
                    }
                }
            }
            
            showAuthModal();
        }

        // Create default admin account if none exists
        function createDefaultAdmin() {
            const adminExists = databaseManager.users.some(u => u.username === 'admin');
            if (!adminExists) {
                securityManager.hashPassword('admin123').then(hashedPassword => {
                    const admin = {
                        id: databaseManager.generateId(),
                        username: 'admin',
                        email: 'admin@daven.world',
                        password: hashedPassword,
                        accountType: 'developer',
                        points: 999999,
                        level: 99,
                        admin: true,
                        banned: false,
                        createdAt: new Date().toISOString(),
                        stats: {
                            gamesPlayed: 0,
                            gamesWon: 0,
                            totalScore: 0,
                            achievements: ['Administrator', 'Platform Creator']
                        }
                    };
                    databaseManager.users.push(admin);
                    databaseManager.saveData('users', databaseManager.users);
                    console.log('Default admin account created: admin / admin123');
                });
            }
        }

        // Event Listeners
        window.addEventListener('load', () => {
            createDefaultAdmin();
            initializeApp();
            handleRouting();
        });

        window.addEventListener('popstate', handleRouting);

        // Save session on page unload
        window.addEventListener('beforeunload', () => {
            if (currentSession) {
                localStorage.setItem('daven_world_session', currentSession.id);
            }
        });

        // Simulate real-time updates
        setInterval(() => {
            if (currentUser) {
                updatePlayerCounts();
                if (currentUser.admin) {
                    loadAdminData();
                }
            }
        }, 5000);
    </script>
</body>
</html>
